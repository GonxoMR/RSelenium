<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>RSelenium: Testing Shiny Apps</title>





<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}
</style>



</head>

<body>
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{Shiny Testing}
-->

<h1>RSelenium: Testing Shiny Apps</h1>

<h2>Introduction</h2>

<p>The goal of this vignette is to give a basic overview of how one might approach &ldquo;testing&rdquo; a shiny app. <a href="http://www.rstudio.com/shiny/">Shiny</a> is a new package from <a href="http://www.rstudio.com/">RStudio</a> that makes it dramatically easier to build interactive web applications with R. Shiny Uses a reactive programming model and has built-in widgets derived from the <a href="http://getbootstrap.com/javascript/">Bootstrap</a> front-end framework. In this vignette we will looking at writing unit tests for a simple shiny wep app. The testing package we will use is <a href="https://github.com/hadley/testthat">testthat</a> which has a short introduction <a href="http://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf">here</a>.</p>

<p>This vignette is divided into five main sections:</p>

<ul>
<li><a href="#id1">Some thoughts on testing.</a></li>
<li><a href="#id2">The shiny test app.</a></li>
<li><a href="#id3">section 3</a></li>
<li><a href="#id4">section 4</a></li>
<li><a href="#id5">section 5</a></li>
</ul>

<p>Each section will be an introduction to an idea in testing shiny apps with Selenium, and point to more detailed explanation in other vignettes.</p>

<h2><a id="id1">Some thoughts on testing.</a></h2>

<h3>Why test?</h3>

<p>When faced with testing for the first time the natural reaction is to think what now? what do i test? how much/many tests do I write? 
Tests need to do something useful to survive. Automated tests should help the team to make the next move by providing justified confidence a bug has been fixed, confirming refactored code still works as intended, or demonstrating that new features have been successfully implemented. There should be sufficient tests – neither more nor less: more increase the support burden, fewer leave us open to unpleasant surprises in production.</p>

<p>One way to create our tests is to take the view of the user. What does the user want to do?
They want to see this particular graph of a given data set. How do they do that? They select various options and input various choices. From this list of actions we can create an outline 
of our code for the test. </p>

<p>For each method, we need to work out how to implement it in code. How could an automated test select the sliderInput bar? Do alternative ways exist? An understanding of HTML, CSS, and JavaScript will help you if you plan to use browser automation tools. All the visible elements of a web application are reflected in the Document Object Model (DOM) in HTML, and they can be addressed in various ways. Some simple examples of interacting with the DOM using <code>RSelenium</code> are given in the <code>Rselenium-basic</code> vignette.</p>

<h3>Vary the tests.</h3>

<p>Having static tests can lead to problems. Introducing variance into the tests can help pick up unexpected errors. This can be achieved by introducing an element of randomness into automatic inputs or randomizing order of selection etc.</p>

<h3>Vary the browsers/OS.</h3>

<p>It can help to test against a variety of browsers and operating systems. <code>RSelenium</code> can interact with services like <a href="http://saucelabs.com/">sauceLabs</a>. <code>sauceLabs</code> allows one to choose the browser or operating system or the version of the selenium server to use. You can test with iOS/Android/Windows/Mac/Linux and browsers like firefox/chrome/ie/opera/safari. This can be very useful to test how your app works on a range of platforms. More detailed information and examples can be seen on the sauceLabs vignette.</p>

<h3>Record the tests.</h3>

<p>RSelenium has the ability to take screenshots of the browser at a particular point in time. 
On failure of a test a screenshot can be useful to understand what happened. If you interface
RSelenium with <code>sauceLabs</code> you get screenshots and videos automatically. See the sauceLabs vignette for further details.</p>

<h3>Test for fixes.</h3>

<p>Lots of bugs are discovered by means other than automated testing – they might be reported by users, for example. Once these bugs are fixed, the fixes must be tested. The tests must establish whether the problem has been fixed and, where practical, show that the root cause has been addressed. Since we want to make sure the bug doesn’t resurface unnoticed in future releases, having automated tests for the bug seems sensible.</p>

<h2><a id="id2">The shiny test app.</a></h2>

<h3>Introduction</h3>

<p>The shiny test app is composed of various widgets from the shiny package (0.8.0.99 at time of writing). We have also included the <code>ggplot2</code> library as output for one of the charts. The app includes examples of some of the controls included with the <code>shiny</code> package namely <code>selectInput</code>, <code>numericInput</code>, <code>dateRangeInput</code> and a <code>sliderInput</code>. These controls are used to produce output rendered using <code>renderPrint</code>, <code>renderPlot(base)</code>  , <code>renderPlot(ggplot2)</code> and <code>renderDataTable</code>.
The app can be viewed if you have <code>shiny</code> installed. </p>

<pre><code>require(shiny)
runApp(paste0(find.package(&quot;RSelenium&quot;), &quot;/apps/shinytestapp&quot;))

</code></pre>

<p>Alternatively there is a version of the app running on the <code>RStudio</code> test server <code>spark</code> at 
<code>http://spark.rstudio.com/johnharrison/shinytestapp/</code>.</p>

<p>An image of the app using <code>RSelenium</code> on a windows 8.1 machine running firefox 16.0</p>

<p><img src="shinytestapp.png"  /></p>

<p>The image was generated using <code>RSelenium</code> and the following code.</p>

<pre><code>user &lt;- &quot;rselenium0&quot;
pass &lt;- &quot;***************************&quot;
port &lt;- 80
ip &lt;- paste0(user, &#39;:&#39;, pass, &quot;@ondemand.saucelabs.com&quot;)
browser &lt;- &quot;firefox&quot;
version &lt;- &quot;26&quot;
platform &lt;- &quot;Windows 8.1&quot;
extraCapabilities &lt;- list(name = &quot;Test RSelenium&quot;, username = user, accessKey = pass)

remDr &lt;- remoteDriver$new(remoteServerAddr = ip, port = port, browserName = browser
                          , version = version, platform = platform
                          , extraCapabilities = extraCapabilities)
remDr$open()
remDr$navigate(&quot;http://spark.rstudio.com/johnharrison/shinytestapp/&quot;)
webElems &lt;- remDr$findElements(&quot;css selector&quot;, &quot;#ctrlSelect input&quot;)
lapply(webElems, function(x){x$clickElement()})
scr &lt;- remDr$screenshot(display = TRUE)
</code></pre>

<h2><a id="id3">section 3</a></h2>

<h2><a id="id4">section 4</a></h2>

<h2><a id="id5">section 5</a></h2>

</body>

</html>
