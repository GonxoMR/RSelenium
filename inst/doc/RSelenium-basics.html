<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>RSelenium basics</title>





<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}
</style>



</head>

<body>
<!--
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{RSelenium basics}
-->

<h1>RSelenium basics</h1>

<h2>Introduction</h2>

<p>The goal of RSelenium is to make it easy to connect to a Selenium Server/ Remote Selenium Server from within R. RSelenium provides R bindings for the Selenium Webdriver API. <a href="http://docs.seleniumhq.org/">Selenium</a> is a project focused on automating web browsers. RSelenium allows you to carry out unit testing and regression testing on your webapps and webpages across a range of browser/OS combinations. This allows us to integrate from within R testing and manipulation of popular projects such as <a href="http://www.rstudio.com/shiny/">shiny</a>, <a href="https://saucelabs.com/">sauceLabs</a>.</p>

<p>This vignette is divided into five main sections:</p>

<ul>
<li><a href="#id1">Connecting to a Selenium Server.</a></li>
<li><a href="#id2">Navigating using RSelenium.</a></li>
<li><a href="#id3">Accessing elements in the DOM.</a></li>
<li><a href="#id4">Sending events to elements.</a></li>
<li><a href="#id5">Injecting JavaScript.</a></li>
</ul>

<p>Each section will be an introduction to a major idea in Selenium, and point to more detailed explanation in other vignettes.</p>

<h2><a id="id1">Connecting to a Selenium Server.</a></h2>

<h3>What is a Selenium Server?</h3>

<p>Selenium Server is  a standalone java program which allows you to run HTML test suites in a range of different browsers, plus extra options like reporting.
You may, or may not, need to run a Selenium Server, depending on how you intend to use Selenium-WebDriver (RSelenium). </p>

<h3>Do I need to run a Selenium Server?</h3>

<p>If you intend to drive a browser on the same machine that RSelenium is running on then you will need to have Selenium Server running on that machine. </p>

<h3>How do I get the Selenium Server stand-alone binary?</h3>

<p>RSelenium has a built-in function that will download the stand-alone java binary and place it in the RSelenium package location in the <code>/bin/</code> directory. If you would like to install elsewhere the function takes a <code>dir</code> argument and can also update an existing binary. </p>

<pre><code>RSelenium::checkForServer()
</code></pre>

<p>If you would like to download the binary manually it is currently found <a href="http://code.google.com/p/selenium/downloads/list">here</a>. Look for <code>selenium-server-standalone-x.xx.x.jar</code>.</p>

<h3>How do I run the Selenium Server?</h3>

<p>There is a utility function included in <code>RSelenium</code> to run an existing stand-alone Selenium Server binary. </p>

<pre><code>RSelenium::startServer()
</code></pre>

<p>By default it looks in the <code>RSelenium</code> package <code>/bin/</code> directory. It has an optional <code>dir</code> argument if your binary is elsewhere. Alternatively you can run the binary manually. Open a console in your OS and navigate to where the binary is located and run:</p>

<pre><code>java -jar selenium-server-standalone-x.xx.x.jar
</code></pre>

<p>By default the <code>Selenium Server</code> listens for connections on port 4444.</p>

<h3>How do I connect to a running server?</h3>

<p><code>RSelenium</code> has a main reference class named <code>remoteDriver</code>. To connect to a server you need to instantiate a new <code>remoteDriver</code> with appropriate options.</p>

<pre><code># RSelenium::startServer() if required
require(RSelenium)
remDr &lt;- remoteDriver(remoteServerAddr = &quot;localhost&quot; 
                      , port = 4444
                      , browserName = &quot;firefox&quot;
                      )
</code></pre>

<p>It would have been sufficient to call <code>remDr &lt;- remoteDriver()</code> but the options where explicitly listed to show how one may connect to an arbitrary ip/port/browser etc. More detail maybe found on the <code>sauceLabs</code> vignette. To connect to the server use the <code>open</code> method.</p>

<pre><code>remDr$open()
</code></pre>

<p>RSelenium should now have a connection to the Selenium Server. You can query the status of the remote Server using the <code>status</code> method.</p>

<pre><code>&gt; remDr$getStatus()
$os
              arch               name            version 
           &quot;amd64&quot;            &quot;Linux&quot; &quot;3.8.0-35-generic&quot; 

$java
   version 
&quot;1.6.0_27&quot; 

$build
             revision                  time               version 
            &quot;ff23eac&quot; &quot;2013-12-16 16:11:15&quot;              &quot;2.39.0&quot; 

</code></pre>

<h1><a id="id2">Navigating using RSelenium.</a></h1>

<h3>Basic Navigation</h3>

<p>To start with we navigate to a url.</p>

<pre><code>remDr$navigate(&quot;http://www.google.com&quot;)
</code></pre>

<p>Then we navigate to a second page.</p>

<pre><code>remDr$navigate(&quot;http://www.bbc.co.uk&quot;)

&gt; remDr$getCurrentUrl()
[[1]]
[1] &quot;http://www.bbc.co.uk/&quot;

</code></pre>

<p>We can go backwards and forwards using the methods <code>goBack</code> and <code>goForward</code>.</p>

<pre><code>remDr$goBack()

&gt; remDr$getCurrentUrl()
[[1]]
[1] &quot;https://www.google.com/&quot;

remDr$goForward()

&gt; remDr$getCurrentUrl()
[[1]]
[1] &quot;http://www.bbc.co.uk/&quot;

</code></pre>

<p>To refresh the current page you can use the refresh method.</p>

<pre><code>remDr$refresh()

</code></pre>

<h2><a id="id3">Accessing elements in the DOM.</a></h2>

<p>The DOM stands for the Document Object Model. It is a cross-platform and language-independent convention for representing and interacting with objects in HTML, XHTML and XML documents. Interacting with the DOM will be very important for us with Selenium and the webDriver provides a number of methods in which to do this.
A basic html page is </p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;body&gt;

&lt;h1&gt;My First Heading&lt;/h1&gt;

&lt;p&gt;My first paragraph.&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;

</code></pre>

<p>The query box on the front page of <code>http://www.google.com</code> has html code <code>input id=&quot;gbqfq&quot; class=&quot;gbqfif&quot;</code> associated with it. The full html associated with the input tag is:</p>

<pre><code>&lt;input type=&quot;text&quot; value=&quot;&quot; autocomplete=&quot;off&quot; name=&quot;q&quot; class=&quot;gbqfif&quot; id=&quot;gbqfq&quot; style=&quot;border: medium none; padding: 0px; margin: 0px; height: auto; width: 100%; background: url(&amp;quot;data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw%3D%3D&amp;quot;) repeat scroll 0% 0% transparent; position: absolute; z-index: 6; left: 0px; outline: medium none;&quot; dir=&quot;ltr&quot; spellcheck=&quot;false&quot;&gt;

</code></pre>

<h3>Search by id.</h3>

<p>To find this element in the DOM a number of methods can be used. We can search by the id.</p>

<pre><code>remDr$navigate(&quot;http://www.google.com/ncr&quot;)
webElem &lt;- remDr$findElement(using = &#39;id&#39;, value = &quot;gbqfq&quot;)

&gt; webElem$getElementAttribute(&quot;id&quot;)
[[1]]
[1] &quot;gbqfq&quot;

&gt; webElem$getElementAttribute(&quot;class&quot;)
[[1]]
[1] &quot;gbqfif&quot;

</code></pre>

<h3>Search by class.</h3>

<p>We can also search by class name.</p>

<pre><code>webElem &lt;- remDr$findElement(using = &#39;class name&#39;, &quot;gbqfif&quot;)

&gt; webElem$getElementAttribute(&quot;class&quot;)
[[1]]
[1] &quot;gbqfif&quot;

&gt; webElem$getElementAttribute(&quot;type&quot;)
[[1]]
[1] &quot;text&quot;

</code></pre>

<h3>Search using css-selectors</h3>

<p>The class is denoted by <code>.</code> when using css selectors. To search on class using css selectors we would use</p>

<pre><code>webElem &lt;- remDr$findElement(using = &#39;css selector&#39;, &quot;input.gbqfif&quot;)

</code></pre>

<p>and to search on id using css-selectors</p>

<pre><code>webElem &lt;- remDr$findElement(using = &#39;css selector&#39;, &quot;input#gbqfq&quot;)

</code></pre>

<p>A good example of searching using css-selectors is given <a href="http://saucelabs.com/resources/selenium/css-selectors">here</a>.</p>

<h3>Search by name</h3>

<p>To search using the <code>name</code> if given of the element. Note that ids are unique in a given html page. Names are not necessarily unique. </p>

<pre><code>webElem &lt;- remDr$findElement(using = &#39;name&#39;, &quot;q&quot;)

&gt; webElem$getElementAttribute(&quot;name&quot;)
[[1]]
[1] &quot;q&quot;

&gt; webElem$getElementAttribute(&quot;id&quot;)
[[1]]
[1] &quot;gbqfq&quot;

</code></pre>

<h3>Search using xpath</h3>

<p>The final option is to search using xpath. Normally one would use xpath by default when searching. </p>

<p>Xpath using id.</p>

<pre><code>webElem &lt;- remDr$findElement(using = &#39;xpath&#39;, &quot;//*/input[@id = &#39;gbqfq&#39;]&quot;)
</code></pre>

<p>Xpath using class.</p>

<pre><code>webElem &lt;- remDr$findElement(using = &#39;xpath&#39;, &quot;//*/input[@class = &#39;gbqfif&#39;]&quot;)
</code></pre>

<h2><a id="id4">Sending events to elements.</a></h2>

<p>To illustrate how to interact with elements we will again use the <code>http://www.google.com/ncr</code> as an example.</p>

<h3>Sending text to elements</h3>

<p>Suppose we would like to search for <code>R cran</code> on google. We would need to find the element for the query box and send the appropriate text to it. We can do this using the <code>sendKeysToElement</code> method for the <code>webElement</code> class.</p>

<pre><code>remDr$navigate(&quot;http://www.google.com/ncr&quot;)
webElem &lt;- remDr$findElement(using = &quot;xpath&quot;, &quot;//*/input[@id = &#39;gbqfq&#39;]&quot;)
webElem$sendKeysToElement(list(&quot;R Cran&quot;))

</code></pre>

<h3>Sending key presses to elements</h3>

<p>We should see that the text <code>R Cran</code> has now been entered into the query box.
How do we press enter. We can simply send the enter key to query box. The enter key would be denoted as <code>&quot;\uE007&quot;</code>. So we could use:</p>

<pre><code>remDr$navigate(&quot;http://www.google.com/ncr&quot;)
webElem &lt;- remDr$findElement(using = &quot;xpath&quot;, &quot;//*/input[@id = &#39;gbqfq&#39;]&quot;)
webElem$sendKeysToElement(list(&quot;R Cran&quot;, &quot;\uE007&quot;))

</code></pre>

<p>It is not very easy to remember utf8 codes for appropriate keys so a mapping has been provided in <code>RSelenium</code>. ?selkeys&#39; will bring up a help page explaining the mapping. The utf codes given <a href="http://code.google.com/p/selenium/wiki/JsonWireProtocol#/session/:sessionId/element/:id/value">here</a> have been mapped to easy to remember names. </p>

<p>To use <code>selkeys</code> we would send the following</p>

<pre><code>remDr$navigate(&quot;http://www.google.com/ncr&quot;)
webElem &lt;- remDr$findElement(using = &quot;xpath&quot;, &quot;//*/input[@id = &#39;gbqfq&#39;]&quot;)
webElem$sendKeysToElement(list(&quot;R Cran&quot;, key = &quot;enter&quot;))

</code></pre>

<p>Typing <code>selKeys</code> into the console will bring up the list of mappings.</p>

<h3>Sending mouse events to elements</h3>

<p>For this example we will go back to the google frontpage and search for
<code>R Cran</code> then we will click the link for the <code>The Comprehensive R Archive Network</code>.</p>

<pre><code>remDr$navigate(&quot;http://www.google.com/ncr&quot;)
webElem &lt;- remDr$findElement(using = &quot;xpath&quot;, &quot;//*/input[@id = &#39;gbqfq&#39;]&quot;)
webElem$sendKeysToElement(list(&quot;R Cran&quot;, key = &quot;enter&quot;))

</code></pre>

<p><code>&lt;li class=&quot;g&quot;&gt;</code> contains the search results we can find all the search entries on the first page using the <code>findElements</code> method. The header for each link is contained further in with a <code>&lt;h3 class = &quot;r&quot;&gt;</code> tag. We will access the <code>h3</code> headers first. It will be succinct to find these elements using <code>css selectors</code>.</p>

<pre><code>webElems &lt;- remDr$findElements(using = &#39;css selector&#39;, &quot;li.g h3.r&quot;)
resHeaders &lt;- unlist(lapply(webElems, function(x){x$getElementText()}))
&gt; resHeaders
 [1] &quot;The Comprehensive R Archive Network&quot;                        
 [2] &quot;Comprehensive R Archive&quot;                                    
 [3] &quot;Mirrors&quot;                                                    
 [4] &quot;Contributed Packages&quot;                                       
 [5] &quot;R for Mac OS X&quot;                                             
 [6] &quot;Download R 3.0.2&quot;                                           
 [7] &quot;CRAN Repository Policy&quot;                                     
 [8] &quot;The R Project for Statistical Computing&quot;                    
 [9] &quot;Cran - Wikipedia, the free encyclopedia&quot;                    
[10] &quot;Comprehensive R Archive Network (CRAN) - StatLib - Carnegie&quot;
[11] &quot;CRAN - Package R.methodsS3&quot;                                 
[12] &quot;CRAN - Package R.cache&quot;                                     
[13] &quot;Ubuntu – Details of package r-cran-sp in lucid&quot;

</code></pre>

<p>We can see that the first link is the one we want but in case googles search results change we refer to it as </p>

<pre><code>webElem &lt;- webElems[[which(resHeaders == &quot;The Comprehensive R Archive Network&quot;)]]

</code></pre>

<p>How do we click the link. We can use the <code>clickElement</code> method:</p>

<pre><code>webElem$clickElement()

&gt; remDr$getCurrentUrl()
[[1]]
[1] &quot;http://cran.r-project.org/&quot;

&gt; remDr$getTitle()
[[1]]
[1] &quot;The Comprehensive R Archive Network&quot;
</code></pre>

<h2><a id="id5">Injecting JavaScript</a></h2>

<p>Sometimes it is necessary to interact with the current url using JavaScript. This maybe necessary to call bespoke methods or to have more control over the page for example by adding the <code>JQuery</code> library to the page if it is missing. <code>Selenium</code> has two methods we can use to execute JavaScript namely
<code>executeScript</code> and <code>executeAsyncScript</code> from the <code>remoteDriver</code> class. We return to the google front page to investigate these methods.</p>

<h3>Injecting JavaScript synchronously</h3>

<p>Returning to the google homepage we can find the element for the <code>google</code> image. The image has <code>id = &quot;hplogo&quot;</code> and
we can use this in an xpath or search by id etc to select the element. In this case we use <code>css selectors</code>:</p>

<pre><code>remDr$navigate(&quot;http://www.google.com/ncr&quot;)
webElem &lt;- remDr$findElement(&quot;css selector&quot;, &quot;img#hplogo&quot;)

</code></pre>

<p>Is the image visible? Clearly it is but we can check using javascript. </p>

<pre><code>&gt; remDr$executeScript(&quot;return document.getElementById(&#39;hplogo&#39;).hidden;&quot;, args = list())
[[1]]
[1] FALSE

</code></pre>

<p>Great so the image is not hidden indicated by the <code>FALSE</code>. We can hide it executing some simple JavaScript.</p>

<pre><code>remDr$executeScript(&quot;document.getElementById(&#39;hplogo&#39;).hidden = true;&quot;, args = list())

&gt; remDr$executeScript(&quot;return document.getElementById(&#39;hplogo&#39;).hidden;&quot;, args = list())
[[1]]
[1] TRUE

</code></pre>

<p>So now the image is hidden. We used an element here given by <code>id = &quot;hplogo&quot;</code>. We had to use the JavaScript function
<code>getElementById</code> to access it. It would be nicer if we could have used <code>webElem</code> which we had specified earlier. 
If we pass a webElement object as an argument to either <code>executeScript</code> or <code>executeAsyncScript</code> <code>RSelenium</code> will pass it in an appropriate fashion.</p>

<pre><code>&gt; remDr$executeScript(&quot;return arguments[0].hidden = false;&quot;, args = list(webElem))
[[1]]
[1] FALSE

</code></pre>

<p>Notive how we passed the web element to the method <code>executeScript</code>. </p>

</body>

</html>
